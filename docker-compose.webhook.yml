version: '3.8'

# Docker Compose configuration with webhook service
# This sets up both the media player and webhook receiver

services:
  nas-player:
    build: .
    container_name: nas-player
    ports:
      - "1699:1699"
    volumes:
      # Mount your Video_Server folder
      - /volume1/Video_Server:/video:ro
      # Mount code directory for live updates
      - /volume1/docker/nas-player:/app:ro
    environment:
      - VIDEO_SERVER_PATH=/video
    restart: unless-stopped
    networks:
      - nas-network

  webhook:
    build:
      context: .
      dockerfile: Dockerfile.webhook
    container_name: nas-player-webhook
    ports:
      - "1700:1700"
    volumes:
      - /volume1/docker/nas-player:/app
      - /var/run/docker.sock:/var/run/docker.sock
    environment:
      - WEBHOOK_SECRET=${WEBHOOK_SECRET:-change-this-secret}
      - DEPLOY_SCRIPT=/app/deploy.sh
    restart: unless-stopped
    networks:
      - nas-network
    depends_on:
      - nas-player

networks:
  nas-network:
    driver: bridge

